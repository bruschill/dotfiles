ZSH_HISTORY_PATH=$HOME/.zsh_history

# load zgen
ZGEN_RESET_ON_CHANGE=$HOME/.zshrc
source $HOME/.zsh_config.d/zgen/zgen.zsh

if ! zgen saved; then
  zgen oh-my-zsh
  zgen oh-my-zsh themes/miloshadzic
  zgen oh-my-zsh plugins/colored-man-pages

  zgen load skx/sysadmin-util
  # zgen load sharat87/zsh-vim-mode
  zgen load lukechilds/zsh-nvm
  zgen save
fi

# load files in zsh_config.d
for file in $HOME/.zsh_config.d/*.zsh; do
  source $file
done

source $HOME/.aliasrc

eval "$(rbenv init -)"

[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh

# added by travis gem
[ -f /Users/bruschill/.travis/travis.sh ] && source /Users/bruschill/.travis/travis.sh

export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh" # This loads nvm
[ -s "$NVM_DIR/bash_completion" ] && . "$NVM_DIR/bash_completion"

# some wild function for nvm I need to reorganize
autoload -U add-zsh-hook
load-nvmrc() {
  local node_version="$(nvm version)"
  local nvmrc_path="$(nvm_find_nvmrc)"

  if [ -n "$nvmrc_path" ]; then
    local nvmrc_node_version=$(nvm version "$(cat "${nvmrc_path}")")

    if [ "$nvmrc_node_version" = "N/A" ]; then
      nvm install
    elif [ "$nvmrc_node_version" != "$node_version" ]; then
      nvm use
    fi
  elif [ "$node_version" != "$(nvm version default)" ]; then
    echo "Reverting to nvm default version"
    nvm use default
  fi
}
add-zsh-hook chpwd load-nvmrc
load-nvmrc
